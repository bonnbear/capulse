<template>
  <div class="timeline-container">
    <div class="types">
      <div v-for="type in types" :key="type">{{ type }}</div>
    </div>
    <div class="timeline">
      <div class="month-container">
        <div class="month" v-for="month in months" :key="month">{{ month }}月</div>
      </div>
      <div v-for="type in types" :key="type" class="type-timeline">
        <div class="content-container">
          <div class="line"></div>
          <div class="contents">
            <div v-for="month in months" :key="month" class="month-content">
              <div class="content" v-for="(event, index) in monthInfo[type][month]" :key="index">
                <div>{{ event.content }}</div>
                <div class="date">{{ event.date }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';

const tableData = ref([
  { date: '2023-01-10', content: '产品发布会', type: '市场活动' },
  { date: '2023-02-14', content: '情人节促销', type: '促销活动' },
  { date: '2023-03-01', content: '新品上市', type: '新品发布' },
  { date: '2023-03-08', content: '妇女节特惠', type: '促销活动' },
  { date: '2023-04-01', content: '愚人节活动', type: '市场活动' },
  { date: '2023-05-01', content: '劳动节放假通知', type: '公司公告' },
  { date: '2023-06-01', content: '儿童节促销', type: '促销活动' },
  { date: '2023-07-01', content: '夏季新品发布', type: '新品发布' },
  { date: '2023-08-01', content: '暑期大促', type: '促销活动' },
  { date: '2023-09-10', content: '教师节感恩活动', type: '市场活动' },
  { date: '2023-10-01', content: '国庆节放假通知', type: '公司公告' },
  { date: '2023-11-11', content: '双11大促', type: '促销活动' },
  { date: '2023-12-25', content: '圣诞节活动', type: '市场活动' },
]);

const types = computed(() => {
  return [...new Set(tableData.value.map(item => item.type))];
});

const months = computed(() => {
  return [...new Set(tableData.value.map(item => item.date.slice(5, 7)))].sort();
});

const monthInfo = computed(() => {
  const info = {};

  types.value.forEach(type => {
    info[type] = {};
    months.value.forEach(month => {
      info[type][month] = [];
    });
  });

  tableData.value.forEach(item => {
    const month = item.date.slice(5, 7);
    const type = item.type;
    info[type][month].push({ content: item.content, date: item.date });
  });

  // 对每个类型的每个月的事件按日期排序
  Object.values(info).forEach(typeInfo => {
    Object.values(typeInfo).forEach(events => {
      events.sort((a, b) => new Date(a.date) - new Date(b.date));
    });
  });

  return info;
});
</script>

<style>
.timeline-container {
  display: flex;
}

.types {
  margin-right: 20px;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  display: flex;
  justify-content: space-around;
}

.timeline {
  flex-grow: 1;
}

.month-container {
  display: flex;
  justify-content: space-around;
  margin-bottom: 20px;
}

.month {
  font-weight: bold;
}

.type-timeline {
  display: flex;
  margin-bottom: 20px;
}

.content-container {
  display: flex;
  flex-grow: 1;
}

.line {
  width: 2px;
  background-color: black;
  margin-right: 10px;
}

.contents {
  flex-grow: 1;
  display: flex;
}

.month-content {
  flex-grow: 1;
}

.content {
  margin-bottom: 5px;
}

.date {
  color: gray;
  font-size: 0.8em;
}
</style>
